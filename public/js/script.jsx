var App = React.createClass({
  getInitialState: function () {
    return {
      word: "",
      success: [],
      fails: []
    };
  },
  componentDidMount: function () {
    document.addEventListener("keydown", this.handleKeydown);
    this.socket.on("newWord", this.setWord);
  },
  socket: io(),
  getWord: function () {
    this.socket.emit("getWord");
  },
  setWord: function (word) {
    var state = this.getInitialState();
        state.word = word;

    this.setState(state);
  },
  handleKeydown: function (e) {
    var charCode = e.which || e.keyCode;
    var char = String.fromCharCode(charCode).toLowerCase();

    if (charCode >= 65 && charCode <= 90 && // key actually has letter
      this.state.success.indexOf(char) < 0 && this.state.fails.indexOf(char) < 0) { // key not used before
      if (this.state.word.indexOf(char) >= 0) {
        this.succeed(char);
      }
      else {
        this.failed(char);
      }
    }
  },
  succeed: function (char) {
    this.state.success.push(char);
    this.setState({success: this.state.success});
  },
  failed: function (char) {
    this.state.fails.push(char);
    this.setState({fails: this.state.fails});
  },
  render: function () {
    var fails = this.state.fails.map(function (char) {
      return <div className="char">{char}</div>;
    });

    var success = [];
    var rule = new RegExp("[^- " + this.state.success.join("") + "]", "g");
    var known = this.state.word.replace(rule, "_");
    for (var i in known) {
      var char = known[i];
      var classes = "char ";
      classes += this.state.success.indexOf(char) >= 0 ? "known" : char === "_" ? "unknown" : "symbol";
      success[i] = <div className={classes}>{char}</div>;
    }

    return <div id="app">
      <div>
        {this.state.word}
        <div onClick={this.getWord}>Reset</div>
      </div>

      <div className="fails">
        <div className="title">You missed:</div>
        <div className="chars">{fails}</div>
      </div>

      <div className="success">
        <div className="chars">{success}</div>
      </div>

      <div id="man">
        <svg width="2.77778in" height="4.51389in"
             viewBox="0 0 400 650">
          <path id="leg-r"
                fill="none" stroke="black" stroke-width="1"
                d="M 254.00,462.00
           C 254.00,462.00 274.42,558.00 274.42,558.00
             274.42,558.00 284.29,605.00 284.29,605.00
             285.51,617.94 268.22,618.25 259.00,620.21
             259.00,620.21 249.00,622.29 249.00,622.29
             243.92,622.78 240.08,620.71 237.99,615.98
             237.99,615.98 231.35,586.00 231.35,586.00
             231.35,586.00 213.79,504.00 213.79,504.00
             213.79,504.00 205.00,462.00 205.00,462.00
             205.00,462.00 254.00,462.00 254.00,462.00 Z" />
          <path id="leg-l"
                fill="none" stroke="black" stroke-width="1"
                d="M 194.00,462.00
           C 194.00,462.00 185.21,504.00 185.21,504.00
             185.21,504.00 167.65,586.00 167.65,586.00
             167.65,586.00 161.01,615.98 161.01,615.98
             158.92,620.71 155.08,622.78 150.00,622.29
             150.00,622.29 140.00,620.21 140.00,620.21
             130.78,618.25 113.49,617.94 114.71,605.00
             114.71,605.00 124.58,558.00 124.58,558.00
             124.58,558.00 145.00,462.00 145.00,462.00
             145.00,462.00 194.00,462.00 194.00,462.00 Z" />
          <path id="foot-r"
                fill="none" stroke="black" stroke-width="1"
                d="M 317.78,627.30
           C 314.09,630.24 304.82,630.65 300.00,631.28
             300.00,631.28 268.00,635.42 268.00,635.42
             263.75,636.02 252.66,638.01 249.00,637.11
             242.55,635.52 240.69,630.01 241.10,624.00
             241.34,620.43 243.00,613.33 246.27,611.43
             248.67,610.04 260.46,609.07 264.00,608.58
             264.00,608.58 280.00,606.71 280.00,606.71
             280.00,606.71 310.00,602.61 310.00,602.61
             323.91,603.49 323.42,622.80 317.78,627.30 Z" />
          <path id="foot-l"
                fill="none" stroke="black" stroke-width="1"
                d="M 127.00,607.73
           C 127.00,607.73 146.87,610.73 146.87,610.73
             149.99,612.14 150.63,615.05 151.69,618.00
             154.40,625.54 155.87,635.69 145.00,637.30
             142.22,637.71 134.15,636.43 131.00,636.00
             131.00,636.00 102.00,632.15 102.00,632.15
             97.22,631.58 82.58,630.23 79.04,628.43
             71.68,624.69 72.31,610.51 77.42,605.42
             79.26,603.57 80.63,603.32 83.00,602.70
             83.00,602.70 127.00,607.73 127.00,607.73 Z" />
          <path id="arm-r"
                fill="none" stroke="black" stroke-width="1"
                d="M 277.00,330.00
           C 277.00,330.00 316.00,369.00 316.00,369.00
             316.00,369.00 331.00,384.00 331.00,384.00
             333.53,386.58 336.46,389.26 337.11,393.00
             337.93,397.76 335.00,400.70 332.15,404.00
             326.89,410.09 316.07,424.65 307.00,421.77
             302.67,420.39 297.28,414.28 294.00,411.00
             294.00,411.00 270.00,387.91 270.00,387.91
             266.34,384.50 254.05,372.94 252.60,369.00
             251.88,367.06 252.00,364.09 252.00,362.00
             252.00,362.00 252.00,307.00 252.00,307.00
             260.99,313.02 269.28,322.28 277.00,330.00 Z" />
          <path id="arm-l"
                fill="none" stroke="black" stroke-width="1"
                d="M 147.00,361.00
           C 146.98,371.28 144.17,371.83 137.00,379.00
             137.00,379.00 117.00,398.00 117.00,398.00
             112.86,402.14 99.23,416.76 95.00,418.62
             92.79,419.46 90.26,419.43 88.00,418.62
             84.69,417.63 82.43,415.34 80.00,412.98
             74.57,407.72 61.66,397.39 64.12,389.00
             65.14,385.53 68.50,382.51 71.00,380.00
             71.00,380.00 85.00,366.00 85.00,366.00
             85.00,366.00 126.00,325.00 126.00,325.00
             131.40,319.60 140.55,309.05 147.00,306.00
             147.00,306.00 147.00,361.00 147.00,361.00 Z" />
          <path id="hand-r"
                fill="none" stroke="black" stroke-width="1"
                d="M 339.44,403.19
           C 346.44,411.41 342.58,424.68 332.00,427.44
             313.57,432.26 304.33,405.45 324.00,398.56
             329.96,397.53 335.29,398.31 339.44,403.19 Z" />
          <path id="hand-l"
                fill="none" stroke="black" stroke-width="1"
                d="M 85.44,401.19
           C 92.44,409.41 88.58,422.68 78.00,425.44
             59.57,430.26 50.33,403.45 70.00,396.56
             75.96,395.53 81.29,396.31 85.44,401.19 Z" />
          <path id="corpus-pants"
                fill="none" stroke="black" stroke-width="1"
                d="M 252.00,419.00
           C 252.00,419.00 252.00,449.00 252.00,449.00
             252.00,449.00 254.00,462.00 254.00,462.00
             254.00,462.00 145.00,462.00 145.00,462.00
             145.00,462.00 146.91,453.00 146.91,453.00
             146.91,453.00 146.91,419.00 146.91,419.00
             146.91,419.00 252.00,419.00 252.00,419.00 Z" />
          <path id="corpus-r"
                fill="none" stroke="black" stroke-width="1"
                d="M 225.00,297.00
           C 229.69,297.00 236.66,296.64 241.00,297.94
             249.47,300.48 251.98,305.89 252.00,314.00
             252.00,314.00 252.00,419.00 252.00,419.00
             252.00,419.00 198.00,419.00 198.00,419.00
             198.00,419.00 198.00,297.00 198.00,297.00
             198.00,297.00 225.00,297.00 225.00,297.00 Z" />
          <path id="corpus-l"
                fill="none" stroke="black" stroke-width="1"
                d="M 147.00,313.00
           C 147.03,300.25 154.33,297.14 166.00,297.00
             166.00,297.00 198.00,297.00 198.00,297.00
             198.00,297.00 198.00,419.00 198.00,419.00
             198.00,419.00 147.00,419.00 147.00,419.00
             147.00,419.00 147.00,313.00 147.00,313.00 Z" />
          <path id="neck"
                fill="none" stroke="black" stroke-width="1"
                d="M 221.00,275.00
           C 221.00,275.00 221.00,291.00 221.00,291.00
             220.96,293.11 221.07,295.57 219.40,297.15
             217.70,298.75 214.24,298.95 212.00,299.27
             205.36,300.23 198.70,300.07 192.00,300.00
             188.77,299.96 178.82,299.24 176.60,297.15
             174.64,295.30 175.00,291.50 175.00,289.00
             175.00,289.00 175.00,275.00 175.00,275.00
             175.00,275.00 221.00,275.00 221.00,275.00 Z" />
          <path id="hair"
                fill="none" stroke="black" stroke-width="1"
                d="M 126.00,142.00
           C 125.99,128.43 129.13,115.66 136.20,104.00
             139.26,98.97 142.63,93.66 148.00,91.00
             150.50,105.02 143.83,124.16 138.14,137.00
             135.32,143.36 132.21,149.50 126.00,153.00
             126.00,153.00 126.00,142.00 126.00,142.00 Z
           M 259.94,104.00
           C 270.53,121.07 270.00,134.00 270.00,153.00
             263.69,148.38 262.13,144.75 258.75,138.00
             252.64,125.77 245.68,104.65 248.00,91.00
             253.55,93.68 256.75,98.86 259.94,104.00 Z
           M 137.28,189.99
           C 139.72,191.88 140.22,200.65 148.00,202.34
             151.36,203.07 158.62,201.02 162.00,199.98
             162.00,199.98 189.00,191.00 189.00,191.00
             191.26,205.32 202.70,204.83 206.55,197.90
             207.96,195.36 207.93,192.80 208.00,190.00
             208.00,190.00 245.00,198.98 245.00,198.98
             247.93,199.00 250.47,198.86 252.69,196.69
             256.66,192.80 253.52,189.31 261.02,189.02
             262.92,188.94 266.88,188.82 268.40,190.02
             270.26,191.49 269.98,194.87 270.00,197.00
             270.00,197.00 270.00,212.00 270.00,212.00
             269.66,240.34 251.34,264.24 226.00,275.59
             216.89,279.66 214.19,280.98 204.00,281.00
             187.64,281.03 185.30,282.38 170.00,275.17
             164.62,272.63 160.90,270.78 156.00,267.25
             138.31,254.53 127.03,233.93 127.00,212.00
             127.00,212.00 127.00,189.00 127.00,189.00
             129.43,189.00 135.44,188.57 137.28,189.99 Z" />
          <path id="eyes"
                fill="none" stroke="black" stroke-width="1"
                d="M 168.00,175.53
           C 161.42,176.94 154.28,168.18 164.02,162.75
             175.38,160.61 176.73,173.65 168.00,175.53 Z
           M 232.00,175.53
           C 225.42,176.94 218.28,168.18 228.02,162.75
             239.38,160.61 240.73,173.65 232.00,175.53 Z" />
          <path id="deco"
                fill="none" stroke="black" stroke-width="1"
                d="M 278.69,191.92
           C 276.05,193.44 271.12,190.65 275.31,186.08
             281.37,184.74 281.33,190.40 278.69,191.92 Z
           M 175.69,221.92
           C 173.05,223.44 168.12,220.65 172.31,216.08
             178.37,214.74 178.33,220.40 175.69,221.92 Z" />
          <path id="mouth"
                fill="none" stroke="black" stroke-width="1"
                d="M 185.53,212.33
           C 194.47,202.69 213.99,205.93 215.00,224.00
             215.00,224.00 181.00,224.00 181.00,224.00
             181.41,219.47 182.32,215.79 185.53,212.33 Z" />
          <path id="ears"
                fill="none" stroke="black" stroke-width="1"
                d="M 127.00,173.00
           C 126.96,175.08 127.13,178.46 124.69,179.29
             121.46,180.40 116.54,176.37 115.66,172.00
             114.68,167.09 118.04,163.84 121.99,161.79
             128.66,161.11 127.09,168.11 127.00,173.00 Z
           M 270.00,180.00
           C 270.00,180.00 270.00,162.00 270.00,162.00
             284.59,162.86 284.59,179.14 270.00,180.00 Z" />
          <path id="skull"
                fill="none" stroke="black" stroke-width="1"
                d="M 126.00,141.00
           C 126.06,90.62 176.12,56.96 223.00,73.70
             248.79,82.91 269.67,109.16 270.00,137.00
             270.00,137.00 270.00,152.00 270.00,152.00
             277.06,152.01 282.27,152.29 287.90,157.34
             297.02,165.52 295.38,180.21 284.99,186.52
             279.88,189.62 275.67,189.00 270.00,189.00
             270.00,213.05 271.54,232.59 255.48,253.00
             243.47,268.27 222.83,280.97 203.00,281.00
             203.00,281.00 192.00,281.00 192.00,281.00
             170.15,280.90 145.49,262.64 135.31,244.00
             125.07,225.24 127.00,209.33 127.00,189.00
             121.03,189.00 116.34,189.36 111.00,186.01
             101.29,179.91 99.42,165.31 108.19,157.53
             114.05,152.33 119.66,152.01 127.00,152.00
             125.83,147.19 125.99,145.84 126.00,141.00 Z" />
          <path id="hangman"
                fill="none" stroke="black" stroke-width="1"
                d="M 224.00,0.00
           C 228.30,0.01 233.21,-0.14 236.78,2.70
             242.34,7.13 242.50,21.67 237.58,26.58
             232.71,31.46 217.85,30.00 211.00,30.00
             211.00,30.00 211.00,61.00 211.00,61.00
             210.98,64.70 210.98,68.65 208.91,71.89
             204.79,78.38 189.62,78.79 184.42,73.58
             181.34,70.51 181.05,66.08 181.00,62.00
             181.00,62.00 181.00,30.00 181.00,30.00
             181.00,30.00 0.00,30.00 0.00,30.00
             0.00,30.00 0.00,0.00 0.00,0.00
             0.00,0.00 224.00,0.00 224.00,0.00 Z" />
        </svg>

      </div>
    </div>;
  }
});

React.render(<App />, document.body);